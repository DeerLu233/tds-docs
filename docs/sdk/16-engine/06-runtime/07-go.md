---
id: go
title: 云引擎 Go 运行环境
sidebar_label: Go
---

import CloudEnvironments from '../_partials/cloud-environments.mdx';
import LeanstorageUsages from '../_partials/leanstorage-usages.mdx';
import CloudTimezone from '../_partials/cloud-timezone.mdx';
import CloudLogs from '../_partials/cloud-logs.mdx';
import CloudInternetAddress from '../_partials/cloud-internet-address.mdx';
import CloudLoadBalancer from '../_partials/cloud-load-balancer.mdx';
import CloudFilesystem from '../_partials/cloud-filesystem.mdx';
import BuildingScripts from '../_partials/building-scripts.mdx';
import BuildingBuildLogs from '../_partials/building-build-logs.mdx';
import CloudCustomDomain from '../_partials/cloud-custom-domain.mdx';
import CloudHealthCheck from '../_partials/cloud-health-check.mdx';
import BuildingSystemDependencies from '../_partials/building-system-dependencies.mdx';

:::info
这篇文档是针对 Go 运行环境的深入介绍，如希望快速地开始使用云引擎，请查看 [云引擎开发指南 § 快速开始](/sdk/engine/cloud-engine#快速开始)。
:::

云引擎目前只支持通过 Go Modules 管理依赖的项目。

所有 Go 项目都必须在根目录下包含一个 `go.mod` 文件才会被云引擎正确识别。

## 构建和启动命令

云引擎默认使用 `go build -o main` 进行构建，然后执行构建出的可执行文件（`main`），你可以在 `leanengine.yaml` 中来自定义构建和启动命令：

```yaml title='leanengine.yaml'
build: go build -o myapp
run: ./myapp
```

## 配置 Go 版本
云引擎会从 `go.mod` 中读取 Go 的版本

```plain title='go.mod'
go 1.14
```

:::note
如未设置 Go 版本，云引擎会默认使用最新的稳定版本。
:::

## 安装依赖（`go.mod`）

云引擎会自动安装 `go.mod` 和 `go.sum` 中列出的依赖。

## 自定义构建过程

<BuildingScripts />

### 构建日志

<BuildingBuildLogs />

### 系统级依赖

<BuildingSystemDependencies />

## 健康检查

<CloudHealthCheck />

## 云引擎 SDK
云引擎 SDK 提供了云函数和 Hook 等功能的支持，但并不是必须的。

### 接入云引擎 SDK

模板项目已经集成了 Go SDK，并且包含 SDK 初始化的逻辑。

如果自行接入其他框架，则需要自己添加依赖：

```go
import "github.com/leancloud/go-sdk/leancloud"
```

同时也需要自行初始化 SDK：

```go
client := leancloud.NewEnvClient()
leancloud.Engine.Init(client)
```

细心的开发者已经发现示例项目是一个基于 [echo](https://github.com/labstack/echo) 的 Web 应用。

Go SDK 以标准库 HTTP 方法的形式提供了可供任意框架接入的接口，以 **echo** 为示例：

```go
// ./adapters/echo.go
//...
func Echo(e *echo.Echo) {
	e.Any("/1/*", echo.WrapHandler(leancloud.Engine.Handler()), setResponseContentType)
	e.Any("/1.1/*", echo.WrapHandler(leancloud.Engine.Handler()), setResponseContentType)
	e.Any("/__engine/*", echo.WrapHandler(leancloud.Engine.Handler()), setResponseContentType)
}

func setResponseContentType(next echo.HandlerFunc) echo.HandlerFunc {
	return func(c echo.Context) error {
		c.Response().Header().Set("Content-Type", "application/json; charset=UTF-8")
		return next(c)
	}
}
```

函数 **Echo** 接收 echo 实例对象，将 Go SDK 中提供 LeanEngine 相关功能的接口绑定到 `/1/` `/1.1/` 和 `/__engine/` 开头的路由前缀上，保证 LeanEngine 相关的底层功能正常。

函数 `setResponseContentType` 设置所有和 LeanEngine 相关的请求的 `Content-Type` 为 `application/json`，并且编码为 `UTF-8`。

大多数 Go Web 框架均提供将标准库 HTTP Handler 转换为特有 Handler 的方法，只要保证能够在其他框架中接入以上两个部件，即可将 LeanEngine 集成入你喜爱的 Go Web 框架中。

### 使用数据存储服务

<LeanstorageUsages />

## 云端环境

### 绑定自定义域名

<CloudCustomDomain />

### 负载均衡和加速节点

<CloudLoadBalancer only='go' />

### 环境变量

<CloudEnvironments />

### 日志

<CloudLogs only='go' />

### 时区

<CloudTimezone />

### 文件系统

<CloudFilesystem />

### 出入口 IP 地址

<CloudInternetAddress />

## 疑难问题
